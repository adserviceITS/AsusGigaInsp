@model AsusGigaInsp.Models.SerialListModels
@{
    ViewBag.Title = "シリアルリスト";
}
<link href="~/Content/SerialList.css" rel="stylesheet" />
@using (Html.BeginForm())
{
    <!-- 検索条件エリア ------------------------------------------------------------------------------------------>
    <div class="form-row">
        <label for="SearchSONo" class="col-form-label-sm">SO#</label>
        @Html.TextBoxFor(model => model.SearchSONo, null, new { @class = "form-control form-control-sm", style = "max-width:150px;", placeholder = "" })
        <label for="SearchSerialNumber" class="col-form-label-sm">シリアル</label>
        @Html.TextBoxFor(model => model.SearchSerialNumber, null, new { @class = "form-control form-control-sm", style = "max-width:150px;", placeholder = "" })
        <label for="Search90N" class="col-form-label-sm">90N</label>
        @Html.TextBoxFor(model => model.Search90N, null, new { @class = "form-control form-control-sm", style = "max-width:150px;", placeholder = "" })
        <label for="SearchModelName" class="col-form-label-sm">Model Name</label>
        @Html.TextBoxFor(model => model.SearchModelName, null, new { @class = "form-control form-control-sm", style = "max-width:150px;", placeholder = "" })
    </div>
    <div class="row">
        <label for="SearchWorkDayFrom" class="col-form-label-sm">作業日</label>
        @Html.TextBoxFor(model => model.SearchWorkDayFrom, null, new { @class = "form-control form-control-sm", style = "max-width:200px;", placeholder = "From" })
        <label for="SearchWorkDayTo" class="col-form-label-sm">～</label>
        @Html.TextBoxFor(model => model.SearchWorkDayTo, null, new { @class = "form-control form-control-sm", style = "max-width:200px;", placeholder = "To" })
        <label for="SearchInstruction" class="col-form-label-sm">ASUS様指示</label>
        @Html.DropDownListFor(
            model => model.SearchInstruction, // プロパティ
            new SelectList(Model.DropDownListInstruction, "InstructionID", "Instruction"),
            "",
            new { @class= "form-control form-control-sm", style="max-width:120px;" }
        )
        <div class="form-check">
            <label for="SearchNGFlg" class="form-check-label col-form-label-sm">NGフラグ</label>
            @Html.CheckBoxFor(
                model => model.SearchNGFlg,  // プロパティ
                new { @class="form-check-input", style="margin-left:10px;" }      // その他の属性
            )
        </div>
    </div>
    <div class="float-right" style="margin-top:15px;">
        <button class="btn btn-danger btn" style="margin-left:auto;" formaction="/SerialList/Search" name="SearchBtn" id="SearchBtn">検索</button>
        <input type="button" class="btn btn-danger btn" onclick="location.href='@Url.Action("SerialUpLoad", "SerialList")'" value="シリアル情報取込" />
        <button class="btn btn-danger btn" formaction="/SerialList/DLCsv" name="DLCsvBtn" id="DLCsvBtn">CSV出力</button>
    </div>

    <!-- 検索結果エリア ------------------------------------------------------------------------------------------>
    <table class="table table-striped table-bordered table-sm table-hover">
        <thead class="thead-light">
            <tr>
                <th colspan="2"></th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().SONo)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().n90N)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().ModelName)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().SerialNumber)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().NGFlg)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().NGReason)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().WorkDay)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().Instruction)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().ShippingAddress)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().DescriptionAds)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().StatusName)</th>
                <th>@Html.DisplayNameFor(model => model.RstSerialList.First().StatusUpdateDate)</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.RstSerialList)
            {
                <tr>
                    <td style="display:none;">@Html.DisplayFor(modelItem => item.SerialID)</td>
                    <td>
                        <button class="btn btn-danger btn-sm EditBtn" formaction='/SerialList/Edit' name="EditBtn" id="EditBtn">修</button>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger btn-sm NGBtn" name="NGBtn" id="NGBtn">NG</button>
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.SONo)</td>
                    <td>@Html.DisplayFor(modelItem => item.n90N)</td>
                    <td>@Html.DisplayFor(modelItem => item.ModelName)</td>
                    <td>@Html.DisplayFor(modelItem => item.SerialNumber)</td>
                    <td>
                        @if (item.NGFlg == "1")
                        {
                            <span class="text-danger font-weight-bold">NG</span>
                        }
                    </td>
                    <td>@Html.DisplayFor(modelItem => item.NGReason)</td>
                    <td>@Html.DisplayFor(modelItem => item.WorkDay)</td>
                    <td>@Html.DisplayFor(modelItem => item.Instruction)</td>
                    <td>@Html.DisplayFor(modelItem => item.ShippingAddress)</td>
                    <td>@Html.DisplayFor(modelItem => item.DescriptionAds)</td>
                    <td>@Html.DisplayFor(modelItem => item.StatusName)</td>
                    <td>@Html.DisplayFor(modelItem => item.StatusUpdateDate)</td>
                </tr>
            }
        </tbody>
    </table>

    <!-- NG押下時の理由入力 ------------------------------------------------------------>
    <div class="modal fade" tabindex="-1" role="dialog" id="NGReasonModal" aria-labelledby="label1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">NG理由</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="閉じる">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <form role="form" id="modalForm" action="/SerialList/NG" method="POST">
                    <!-- Modal ボディー -->
                    <div class="modal-body">
                        <div class="form-row" style="margin-bottom: 10px;">
                            @Html.TextAreaFor(model => model.inputNGReason, 6, 100, new { @class = "form-control form-control-sm  d-flex align-items-center", style = "max-width:400px;", placeholder = "NG理由" })
                        </div>
                    </div>
                    @Html.HiddenFor(model => model.SelectSerialID)
                    <!-- Modal フッター -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">閉じる</button>
                        <button type="submit" class="btn btn-primary" formaction='/SerialList/NG' id="UpdateNGBtn">登録</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

<script type="text/javascript">
    $(function () {
        // 日付選択のカレンダー表示
        $('#SearchWorkDayFrom, #SearchWorkDayTo').datepicker({
            buttonImage: "/img/calendar-icon.png",        // カレンダーアイコン画像
            buttonText: "カレンダーから選択", // ツールチップ表示文言
            buttonImageOnly: true,           // 画像として表示
            showOn: "button"                   // カレンダー呼び出し元の定義
        });

        // 修正ボタンを押下時
        $('.EditBtn').click(function () {
            // 選択した行のシリアルIDをhiddenに設定
            var strSelectSerialID = $(this).closest("tr").children("td")[0].textContent;
            strSelectSerialID = $.trim(strSelectSerialID);
            $('input:hidden[name="SelectSerialID"]').val(strSelectSerialID);
        });

        // NGボタンを押下時
        $('.NGBtn').click(function () {
            // 選択した行のシリアルIDをhiddenに設定
            var strSelectSerialID = $(this).closest("tr").children("td")[0].textContent;
            strSelectSerialID = $.trim(strSelectSerialID);
            $('input:hidden[name="SelectSerialID"]').val(strSelectSerialID);
            $('#NGReasonModal').modal();
        });

    });
</script>
